<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pulse FM — Focus Radio</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root {
      --bg: #070A10;
      --panel: rgba(255, 255, 255, .06);
      --panel-2: rgba(255, 255, 255, .09);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .62);
      --border: rgba(255, 255, 255, .10);

      /* aurora */
      --aurora-a: 170 255 220;
      --aurora-b: 130 190 255;
      --aurora-c: 210 140 255;

      /* reactive intensity 0..1 */
      --react: 0;

      --radius: 18px;
      --shadow: 0 18px 60px rgba(0, 0, 0, .45);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: var(--font);
      color: var(--text);
      background: radial-gradient(1200px 700px at 25% 0%, rgba(255, 255, 255, .06), transparent 55%),
        radial-gradient(900px 600px at 80% 15%, rgba(255, 255, 255, .05), transparent 55%),
        var(--bg);
      overflow-x: hidden;
    }

    /* Subtle grain for lofi vibe */
    .grain {
      pointer-events: none;
      position: fixed;
      inset: 0;
      opacity: .10;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    /* Aurora layer */
    .aurora {
      position: fixed;
      inset: -20vmax;
      pointer-events: none;
      filter: blur(32px) saturate(120%);
      opacity: calc(.12 + var(--react) * .18);
      transform: translateZ(0);
    }

    .aurora::before,
    .aurora::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(40vmax 24vmax at 20% 30%, rgb(var(--aurora-a) / .20), transparent 60%),
        radial-gradient(34vmax 24vmax at 70% 25%, rgb(var(--aurora-b) / .20), transparent 60%),
        radial-gradient(42vmax 26vmax at 60% 75%, rgb(var(--aurora-c) / .18), transparent 60%);
      animation: drift 18s ease-in-out infinite alternate;
    }

    .aurora::after {
      opacity: .8;
      transform: rotate(8deg) scale(1.05);
      animation-duration: 26s;
    }

    @keyframes drift {
      from {
        transform: translate3d(-2%, -2%, 0) rotate(-2deg)
      }

      to {
        transform: translate3d(2%, 1.5%, 0) rotate(3deg)
      }
    }

    /* App layout */
    .wrap {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7, 10, 16, .86), rgba(7, 10, 16, .55));
      border-bottom: 1px solid rgba(255, 255, 255, .06);
      z-index: 10;
    }

    .topbar {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: .3px;
    }

    .logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background:
        radial-gradient(10px 10px at 30% 30%, rgba(255, 255, 255, .22), transparent 55%),
        linear-gradient(135deg, rgb(var(--aurora-b)/.65), rgb(var(--aurora-c)/.55));
      box-shadow: 0 10px 30px rgba(0, 0, 0, .4);
      border: 1px solid rgba(255, 255, 255, .10);
    }

    .title small {
      display: block;
      font-weight: 500;
      color: var(--muted);
      margin-top: 2px;
      letter-spacing: .2px;
    }

    .spacer {
      flex: 1
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .08);
      color: var(--muted);
      font-size: 13px;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .28);
      box-shadow: 0 0 0 3px rgba(255, 255, 255, .06);
    }

    .dot.live {
      background: rgb(var(--aurora-a) / .85);
      box-shadow: 0 0 0 3px rgb(var(--aurora-a) / .12),
        0 0 18px rgb(var(--aurora-a) / calc(.18 + var(--react) * .25));
    }

    .iconbtn {
      appearance: none;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .05);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 11px;
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }

    .iconbtn:hover {
      background: rgba(255, 255, 255, .07);
      border-color: rgba(255, 255, 255, .14)
    }

    .iconbtn:active {
      transform: translateY(1px) scale(.99)
    }

    main {
      flex: 1;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      padding: 26px 18px 30px;
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
    }

    @media (max-width: 980px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    /* Panels */
    .card {
      border-radius: var(--radius);
      background: linear-gradient(to bottom, rgba(255, 255, 255, .07), rgba(255, 255, 255, .04));
      border: 1px solid rgba(255, 255, 255, .10);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -2px;
      background:
        radial-gradient(600px 260px at 20% 10%, rgb(var(--aurora-b) / calc(.05 + var(--react) * .12)), transparent 55%),
        radial-gradient(520px 260px at 90% 30%, rgb(var(--aurora-a) / calc(.04 + var(--react) * .10)), transparent 55%);
      opacity: .65;
      pointer-events: none;
      filter: blur(14px);
    }

    .card>* {
      position: relative;
      z-index: 1;
    }

    .section {
      padding: 18px 18px 16px;
    }

    .section+.section {
      border-top: 1px solid rgba(255, 255, 255, .08);
    }

    .hrow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .hrow h2 {
      margin: 0;
      font-size: 15px;
      color: rgba(255, 255, 255, .84);
      font-weight: 650;
      letter-spacing: .2px;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    /* Player */
    .player {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .play {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .14);
      background: rgba(255, 255, 255, .06);
      cursor: pointer;
      display: grid;
      place-items: center;
      transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
      box-shadow: 0 0 0 0 rgb(var(--aurora-b)/0);
    }

    .play:hover {
      background: rgba(255, 255, 255, .08);
    }

    .play.playing {
      box-shadow: 0 0 0 6px rgb(var(--aurora-b) / calc(.04 + var(--react) * .12)),
        0 0 26px rgb(var(--aurora-c) / calc(.10 + var(--react) * .22));
      border-color: rgb(var(--aurora-b) / .35);
    }

    .play:active {
      transform: translateY(1px) scale(.99)
    }

    .play svg {
      width: 22px;
      height: 22px;
      fill: rgba(255, 255, 255, .9)
    }

    .meta {
      min-width: 0;
      flex: 1;
    }

    .track {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
      min-width: 0;
    }

    .track strong {
      font-size: 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .04);
      color: rgba(255, 255, 255, .70);
      white-space: nowrap;
    }

    .tag.glow {
      border-color: rgb(var(--aurora-a) / calc(.12 + var(--react) * .26));
      box-shadow: 0 0 18px rgb(var(--aurora-a) / calc(.05 + var(--react) * .20));
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .slider {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, .75);
      font-size: 13px;
    }

    input[type="range"] {
      accent-color: rgb(var(--aurora-b) / .8);
      width: 160px;
    }

    .btn {
      appearance: none;
      cursor: pointer;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .05);
      color: rgba(255, 255, 255, .86);
      font-weight: 600;
      font-size: 13px;
      transition: background .2s ease, border-color .2s ease, transform .08s ease, box-shadow .2s ease;
    }

    .btn:hover {
      background: rgba(255, 255, 255, .07);
      border-color: rgba(255, 255, 255, .14);
    }

    .btn:active {
      transform: translateY(1px) scale(.99)
    }

    .btn.primary {
      border-color: rgb(var(--aurora-b) / calc(.20 + var(--react) * .35));
      box-shadow: 0 0 0 6px rgb(var(--aurora-b) / calc(.04 + var(--react) * .10));
    }

    .btn.ghost {
      background: transparent;
    }

    /* Timer */
    .timerRow {
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    .timerDisplay {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .04);
    }

    .ring {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, .16);
      position: relative;
      box-shadow: 0 0 22px rgb(var(--aurora-a) / calc(.05 + var(--react) * .18));
    }

    .ring::after {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 999px;
      border: 2px solid rgb(var(--aurora-a) / calc(.10 + var(--react) * .35));
      clip-path: inset(0 calc(100% - (var(--p, 0) * 1%)) 0 0 round 999px);
    }

    .time {
      font-variant-numeric: tabular-nums;
      font-weight: 750;
      letter-spacing: .3px;
    }

    /* Right column mini panels */
    .stack {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .row2 {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .drawer {
      display: none;
      padding-top: 12px;
    }

    .drawer.open {
      display: block;
    }

    .list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, .09);
      background: rgba(255, 255, 255, .03);
    }

    .list .name {
      min-width: 0;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-size: 13px;
      color: rgba(255, 255, 255, .82);
    }

    .tiny {
      font-size: 12px;
      color: rgba(255, 255, 255, .58);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }

    /* Focus Mode collapses extras */
    body.focus-mode .optional {
      display: none !important;
    }

    body.focus-mode main {
      grid-template-columns: 1fr;
      max-width: 820px;
    }

    /* Modal / overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .55);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99;
      padding: 18px;
    }

    .overlay.open {
      display: flex;
    }

    .modal {
      width: min(520px, 100%);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: linear-gradient(to bottom, rgba(20, 25, 40, .92), rgba(10, 12, 20, .92));
      box-shadow: 0 25px 90px rgba(0, 0, 0, .6);
      overflow: hidden;
    }

    .modal header {
      position: static;
      background: transparent;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      backdrop-filter: none;
    }

    .modal .topbar {
      padding: 14px 16px;
    }

    .modal .content {
      padding: 16px;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 520px) {
      .grid2 {
        grid-template-columns: 1fr;
      }
    }

    .opt {
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .04);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .opt label {
      font-size: 13px;
      color: rgba(255, 255, 255, .78);
    }

    .opt select,
    .opt input[type="number"] {
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .05);
      color: rgba(255, 255, 255, .86);
      outline: none;
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 3px 7px;
      border: 1px solid rgba(255, 255, 255, .12);
      border-bottom-color: rgba(255, 255, 255, .20);
      border-radius: 10px;
      background: rgba(255, 255, 255, .04);
      color: rgba(255, 255, 255, .78);
      white-space: nowrap;
    }

    footer {
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      padding: 0 18px 22px;
      color: rgba(255, 255, 255, .45);
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Accessibility */
    .sr {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <div class="aurora" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="topbar">
        <div class="brand" role="banner" aria-label="Pulse FM">
          <div class="logo" aria-hidden="true"></div>
          <div class="title">
            Pulse FM
            <small>chill lofi focus radio</small>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="pill" id="livePill" title="Stream status">
          <span class="dot" id="liveDot"></span>
          <span id="statusText">Paused</span>
        </div>

        <button class="iconbtn" id="focusToggle" title="Focus Mode (F)" aria-pressed="false">
          <!-- focus icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 8V6a2 2 0 0 1 2-2h2M20 8V6a2 2 0 0 0-2-2h-2M4 16v2a2 2 0 0 0 2 2h2M20 16v2a2 2 0 0 1-2 2h-2"
              stroke="rgba(255,255,255,.8)" stroke-width="2" stroke-linecap="round" />
          </svg>
          <span class="sr">Toggle focus mode</span>
        </button>

        <button class="iconbtn" id="settingsBtn" title="Theme & Settings" aria-haspopup="dialog">
          <!-- sliders icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3" stroke="rgba(255,255,255,.8)" stroke-width="2"
              stroke-linecap="round" />
            <path d="M2 14h4M10 8h4M18 12h4" stroke="rgba(255,255,255,.8)" stroke-width="2" stroke-linecap="round" />
          </svg>
          <span class="sr">Open settings</span>
        </button>

        <button class="iconbtn" id="helpBtn" title="Keyboard shortcuts (?)">
          <span style="font-weight:800; letter-spacing:.2px">?</span>
          <span class="sr">Open keyboard shortcuts</span>
        </button>
      </div>
    </header>

    <main>
      <!-- LEFT: Player + Timer -->
      <section class="card" aria-label="Player">
        <div class="section">
          <div class="hrow">
            <h2>Player</h2>
            <div class="muted optional">
              Use <span class="kbd">Space</span> to play/pause · <span class="kbd">↑</span>/<span class="kbd">↓</span>
              volume
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="player">
            <button class="play" id="playBtn" aria-label="Play">
              <svg id="playIcon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M8 5v14l11-7z"></path>
              </svg>
              <svg id="pauseIcon" viewBox="0 0 24 24" aria-hidden="true" style="display:none">
                <path d="M7 5h4v14H7zM13 5h4v14h-4z"></path>
              </svg>
            </button>

            <div class="meta">
              <div class="track">
                <strong id="trackTitle">Pulse FM — Live Lofi Stream</strong>
                <span class="tag glow" id="moodTag">rainy</span>
              </div>

              <div class="controls">
                <div class="slider" title="Volume">
                  <span style="width:54px; display:inline-block; color:rgba(255,255,255,.65)">Vol</span>
                  <input id="vol" type="range" min="0" max="1" step="0.01" value="0.7" />
                </div>

                <button class="btn primary" id="enhanceBtn" aria-expanded="false" aria-controls="enhanceDrawer">
                  Enhance
                </button>

                <button class="btn ghost optional" id="copyLinkBtn" title="Copy timestamp link">
                  Copy link
                </button>

                <button class="btn ghost optional" id="favBtn" aria-pressed="false" title="Save this vibe">
                  ☆ Save
                </button>
              </div>
            </div>
          </div>

          <!-- hidden native audio element -->
          <audio id="audio" crossorigin="anonymous" preload="none"></audio>

          <div id="enhanceDrawer" class="drawer optional" aria-label="Enhance controls">
            <div class="row2">
              <div class="opt" style="flex:1">
                <label for="auroraIntensity">Aurora intensity</label>
                <input id="auroraIntensity" type="range" min="0" max="1" step="0.01" value="0.65" />
              </div>
              <div class="opt" style="flex:1">
                <label for="limiter">Safe volume</label>
                <select id="limiter">
                  <option value="off">Off</option>
                  <option value="on" selected>On</option>
                </select>
              </div>
            </div>

            <div style="height:12px"></div>

            <div class="row2">
              <div class="opt" style="flex:1">
                <label for="bass">Bass</label>
                <input id="bass" type="range" min="-12" max="12" step="1" value="2" />
              </div>
              <div class="opt" style="flex:1">
                <label for="treble">Treble</label>
                <input id="treble" type="range" min="-12" max="12" step="1" value="1" />
              </div>
            </div>
          </div>
        </div>

        <div class="section" aria-label="Timer">
          <div class="hrow">
            <h2>Focus timer</h2>
            <div class="muted optional">
              Toggle with <span class="kbd">T</span> · Focus mode: <span class="kbd">F</span>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="timerRow">
            <div class="timerDisplay" title="Current session">
              <div class="ring" id="ring" style="--p:0"></div>
              <div>
                <div class="muted" id="timerLabel">Focus</div>
                <div class="time" id="timerText">25:00</div>
              </div>
            </div>

            <div class="row2">
              <button class="btn" id="pomodoroBtn">Pomodoro</button>
              <button class="btn ghost" id="customBtn">Custom</button>
              <button class="btn" id="timerStartBtn">Start</button>
              <button class="btn ghost" id="timerResetBtn">Reset</button>
            </div>

            <div class="muted optional" id="sessionStats" style="margin-left:auto">
              Today: <span id="todayMin">0</span> min · Streak: <span id="streak">0</span> days
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Ambient + History + Info -->
      <aside class="stack">
        <section class="card optional" aria-label="Ambient">
          <div class="section">
            <div class="hrow">
              <h2>Ambient layer</h2>
              <div class="muted">Blend softly</div>
            </div>

            <div style="height:12px"></div>

            <div class="row2">
              <button class="btn" data-amb="rain">Rain</button>
              <button class="btn" data-amb="cafe">Cafe</button>
              <button class="btn" data-amb="waves">Waves</button>
              <button class="btn" data-amb="noise">White noise</button>
            </div>

            <div style="height:12px"></div>

            <div class="slider">
              <span style="width:54px; display:inline-block; color:rgba(255,255,255,.65)">Amb</span>
              <input id="ambVol" type="range" min="0" max="1" step="0.01" value="0.35" />
            </div>

            <audio id="ambient" loop preload="none"></audio>
            <div class="muted" style="margin-top:10px">
              Tip: keep ambient low to avoid fatigue.
            </div>
          </div>
        </section>

        <section class="card optional" aria-label="History">
          <div class="section">
            <div class="hrow">
              <h2>Recent</h2>
              <button class="btn ghost" id="historyBtn" aria-expanded="false" aria-controls="historyDrawer">
                Toggle
              </button>
            </div>

            <div id="historyDrawer" class="drawer">
              <ul class="list" id="historyList">
                <li><span class="name">Lo-fi stream — “Midnight Pages”</span><span class="tiny">-02:14</span></li>
                <li><span class="name">Lo-fi stream — “Cafe Lanterns”</span><span class="tiny">-06:40</span></li>
                <li><span class="name">Lo-fi stream — “Rain Study Loop”</span><span class="tiny">-12:03</span></li>
              </ul>
              <div class="muted" style="margin-top:10px">
                (Mock data) Hook this up to your metadata/titles if available.
              </div>
            </div>
          </div>
        </section>

        <section class="card" aria-label="Focus mode hint">
          <div class="section">
            <div class="hrow">
              <h2>Focus Mode</h2>
              <span class="tag">minimal UI</span>
            </div>
            <div class="muted" style="margin-top:10px">
              One click collapses extras into a calm, distraction-free player + timer.
            </div>
          </div>
        </section>
      </aside>
    </main>

    <footer>
      <div>Pulse FM — mock UI · Dark mode · Aurora reacts while playing</div>
      <div class="optional">Shortcuts: <span class="kbd">Space</span> play/pause · <span class="kbd">F</span> focus ·
        <span class="kbd">T</span> timer · <span class="kbd">?</span> help</div>
    </footer>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="overlay" id="settingsOverlay" role="dialog" aria-modal="true" aria-label="Theme & Settings">
    <div class="modal">
      <header>
        <div class="topbar">
          <div class="brand">
            <div class="logo" aria-hidden="true" style="width:28px;height:28px;border-radius:10px"></div>
            <div class="title">Theme & Settings</div>
          </div>
          <div class="spacer"></div>
          <button class="iconbtn" id="closeSettings" title="Close (Esc)">✕</button>
        </div>
      </header>

      <div class="content">
        <div class="grid2">
          <div class="opt">
            <label for="themeSelect">Aurora colorway</label>
            <select id="themeSelect">
              <option value="midnight" selected>Midnight Mint</option>
              <option value="sunset">Warm Sunset</option>
              <option value="neon">Neon Violet</option>
            </select>
          </div>
          <div class="opt">
            <label for="motionSelect">Motion</label>
            <select id="motionSelect">
              <option value="low">Low</option>
              <option value="med" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>

          <div class="opt">
            <label for="fontSize">Font size</label>
            <select id="fontSize">
              <option value="normal" selected>Normal</option>
              <option value="large">Large</option>
            </select>
          </div>

          <div class="opt">
            <label for="customFocus">Custom focus (min)</label>
            <input id="customFocus" type="number" min="5" max="180" value="50" />
          </div>

          <div class="opt">
            <label for="customBreak">Custom break (min)</label>
            <input id="customBreak" type="number" min="1" max="60" value="10" />
          </div>

          <div class="opt">
            <label for="reduceGlow">Reduce glow</label>
            <select id="reduceGlow">
              <option value="off" selected>Off</option>
              <option value="on">On</option>
            </select>
          </div>
        </div>

        <div style="height:14px"></div>
        <div class="muted">
          Tip: keep motion low for long study sessions. Your vibe should feel alive, not distracting.
        </div>
      </div>
    </div>
  </div>

  <!-- SHORTCUTS OVERLAY -->
  <div class="overlay" id="helpOverlay" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts">
    <div class="modal">
      <header>
        <div class="topbar">
          <div class="brand">
            <div class="logo" aria-hidden="true" style="width:28px;height:28px;border-radius:10px"></div>
            <div class="title">Keyboard shortcuts</div>
          </div>
          <div class="spacer"></div>
          <button class="iconbtn" id="closeHelp" title="Close (Esc)">✕</button>
        </div>
      </header>
      <div class="content">
        <ul class="list">
          <li><span class="name">Play / pause</span><span class="tiny"><span class="kbd">Space</span></span></li>
          <li><span class="name">Volume up / down</span><span class="tiny"><span class="kbd">↑</span> / <span
                class="kbd">↓</span></span></li>
          <li><span class="name">Toggle Focus Mode</span><span class="tiny"><span class="kbd">F</span></span></li>
          <li><span class="name">Start/Stop Timer</span><span class="tiny"><span class="kbd">T</span></span></li>
          <li><span class="name">Open help</span><span class="tiny"><span class="kbd">?</span></span></li>
          <li><span class="name">Close dialogs</span><span class="tiny"><span class="kbd">Esc</span></span></li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // ----------------------------
    // CONFIG: set your stream URLs
    // ----------------------------
    const STREAM_URL = "https://example.com/your-live-stream.mp3"; // <-- replace
    const AMBIENTS = {
      rain: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_1f8e1baf03.mp3?filename=rain-ambient-110760.mp3",
      cafe: "https://cdn.pixabay.com/download/audio/2022/01/18/audio_8b6c6737c1.mp3?filename=coffee-shop-ambience-6265.mp3",
      waves: "https://cdn.pixabay.com/download/audio/2022/03/22/audio_1f5c71a9c4.mp3?filename=ocean-waves-ambient-112573.mp3",
      noise: "https://cdn.pixabay.com/download/audio/2022/03/24/audio_1f5f2aa2c1.mp3?filename=white-noise-ambient-113010.mp3"
    };

    // Elements
    const audio = document.getElementById("audio");
    const ambient = document.getElementById("ambient");
    const playBtn = document.getElementById("playBtn");
    const playIcon = document.getElementById("playIcon");
    const pauseIcon = document.getElementById("pauseIcon");
    const vol = document.getElementById("vol");
    const ambVol = document.getElementById("ambVol");
    const moodTag = document.getElementById("moodTag");
    const liveDot = document.getElementById("liveDot");
    const statusText = document.getElementById("statusText");
    const livePill = document.getElementById("livePill");

    const enhanceBtn = document.getElementById("enhanceBtn");
    const enhanceDrawer = document.getElementById("enhanceDrawer");
    const historyBtn = document.getElementById("historyBtn");
    const historyDrawer = document.getElementById("historyDrawer");

    const focusToggle = document.getElementById("focusToggle");
    const settingsBtn = document.getElementById("settingsBtn");
    const settingsOverlay = document.getElementById("settingsOverlay");
    const closeSettings = document.getElementById("closeSettings");

    const helpBtn = document.getElementById("helpBtn");
    const helpOverlay = document.getElementById("helpOverlay");
    const closeHelp = document.getElementById("closeHelp");

    const copyLinkBtn = document.getElementById("copyLinkBtn");
    const favBtn = document.getElementById("favBtn");

    // Enhance controls
    const auroraIntensity = document.getElementById("auroraIntensity");
    const limiter = document.getElementById("limiter");
    const bass = document.getElementById("bass");
    const treble = document.getElementById("treble");

    // Settings
    const themeSelect = document.getElementById("themeSelect");
    const motionSelect = document.getElementById("motionSelect");
    const fontSize = document.getElementById("fontSize");
    const reduceGlow = document.getElementById("reduceGlow");
    const customFocus = document.getElementById("customFocus");
    const customBreak = document.getElementById("customBreak");

    // Timer
    const timerLabel = document.getElementById("timerLabel");
    const timerText = document.getElementById("timerText");
    const ring = document.getElementById("ring");
    const pomodoroBtn = document.getElementById("pomodoroBtn");
    const customBtn = document.getElementById("customBtn");
    const timerStartBtn = document.getElementById("timerStartBtn");
    const timerResetBtn = document.getElementById("timerResetBtn");
    const todayMinEl = document.getElementById("todayMin");
    const streakEl = document.getElementById("streak");

    // ----------------------------
    // Audio setup + reactive glow
    // ----------------------------
    audio.src = STREAM_URL;
    audio.volume = Number(vol.value);

    ambient.volume = Number(ambVol.value);

    let ctx, analyser, srcNode, bassEQ, trebleEQ, limiterNode;
    let playing = false;
    let reactTarget = 0;

    function ensureAudioGraph() {
      if (ctx) return;

      ctx = new (window.AudioContext || window.webkitAudioContext)();

      analyser = ctx.createAnalyser();
      analyser.fftSize = 1024;

      // EQ
      bassEQ = ctx.createBiquadFilter();
      bassEQ.type = "lowshelf";
      bassEQ.frequency.value = 140;
      bassEQ.gain.value = Number(bass.value);

      trebleEQ = ctx.createBiquadFilter();
      trebleEQ.type = "highshelf";
      trebleEQ.frequency.value = 3200;
      trebleEQ.gain.value = Number(treble.value);

      // simple "safe volume" compressor/limiter
      limiterNode = ctx.createDynamicsCompressor();
      limiterNode.threshold.value = -18;
      limiterNode.knee.value = 12;
      limiterNode.ratio.value = 6;
      limiterNode.attack.value = 0.01;
      limiterNode.release.value = 0.15;

      srcNode = ctx.createMediaElementSource(audio);

      // Graph: src -> bass -> treble -> (limiter?) -> analyser -> destination
      srcNode.connect(bassEQ);
      bassEQ.connect(trebleEQ);

      // limiter toggle
      trebleEQ.connect(limiterNode);
      trebleEQ.connect(analyser);

      limiterNode.connect(analyser);
      limiterNode.connect(ctx.destination);
      analyser.connect(ctx.destination); // analyser is passive; connecting ok but redundant; keep simple

      setLimiterState(limiter.value === "on");
      requestAnimationFrame(tickReactive);
    }

    function setLimiterState(on) {
      // If off, we just set compressor threshold high so it barely engages.
      if (!limiterNode) return;
      if (on) {
        limiterNode.threshold.value = -18;
        limiterNode.ratio.value = 6;
      } else {
        limiterNode.threshold.value = 0;
        limiterNode.ratio.value = 1;
      }
    }

    function tickReactive() {
      if (analyser) {
        const data = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(data);

        // Focus on low frequencies (first ~10% bins) for slow pulses (less distracting)
        const n = Math.max(8, Math.floor(data.length * 0.10));
        let sum = 0;
        for (let i = 0; i < n; i++) sum += data[i];
        const avg = sum / n; // 0..255

        // Normalize and smooth
        const raw = Math.min(1, Math.max(0, (avg - 10) / 120)); // tweak feel
        reactTarget = raw;
      }

      // Smooth damp the CSS variable
      const current = Number(getComputedStyle(document.documentElement).getPropertyValue("--react")) || 0;
      const intensity = Number(auroraIntensity.value); // user control
      const next = current + (reactTarget * intensity - current) * 0.08;
      document.documentElement.style.setProperty("--react", next.toFixed(4));

      requestAnimationFrame(tickReactive);
    }

    // ----------------------------
    // Player controls
    // ----------------------------
    function setPlayingUI(isPlaying) {
      playing = isPlaying;
      playIcon.style.display = isPlaying ? "none" : "block";
      pauseIcon.style.display = isPlaying ? "block" : "none";
      playBtn.classList.toggle("playing", isPlaying);

      liveDot.classList.toggle("live", isPlaying);
      statusText.textContent = isPlaying ? "Playing" : "Paused";
      livePill.title = isPlaying ? "Live stream playing" : "Paused";

      // Mood tag glow feels alive only when playing
      moodTag.classList.toggle("glow", isPlaying);
    }

    async function togglePlay() {
      ensureAudioGraph();

      // required on iOS/some browsers to resume context in a user gesture
      if (ctx && ctx.state !== "running") await ctx.resume();

      if (!playing) {
        try {
          // set stream src if user changed it later
          if (!audio.src) audio.src = STREAM_URL;
          await audio.play();
          setPlayingUI(true);
        } catch (e) {
          console.warn("Play failed:", e);
          alert("Couldn’t start playback. Check stream URL / CORS / autoplay policies.");
        }
      } else {
        audio.pause();
        setPlayingUI(false);
      }
    }

    playBtn.addEventListener("click", togglePlay);
    vol.addEventListener("input", () => { audio.volume = Number(vol.value); });

    // Safe volume toggle
    limiter.addEventListener("change", () => setLimiterState(limiter.value === "on"));

    // EQ
    bass.addEventListener("input", () => { if (bassEQ) bassEQ.gain.value = Number(bass.value); });
    treble.addEventListener("input", () => { if (trebleEQ) trebleEQ.gain.value = Number(treble.value); });

    // Enhance drawer
    enhanceBtn.addEventListener("click", () => {
      const open = enhanceDrawer.classList.toggle("open");
      enhanceBtn.setAttribute("aria-expanded", String(open));
    });

    // History drawer
    historyBtn.addEventListener("click", () => {
      const open = historyDrawer.classList.toggle("open");
      historyBtn.setAttribute("aria-expanded", String(open));
    });

    // Copy timestamp link (for live streams, we can copy current page + time since start if available)
    copyLinkBtn.addEventListener("click", async () => {
      const t = Math.floor(audio.currentTime || 0);
      const url = new URL(window.location.href);
      url.searchParams.set("t", String(t));
      try {
        await navigator.clipboard.writeText(url.toString());
        copyLinkBtn.textContent = "Copied!";
        setTimeout(() => copyLinkBtn.textContent = "Copy link", 900);
      } catch {
        prompt("Copy link:", url.toString());
      }
    });

    // Save vibe (local)
    favBtn.addEventListener("click", () => {
      const on = favBtn.getAttribute("aria-pressed") === "true";
      favBtn.setAttribute("aria-pressed", String(!on));
      favBtn.textContent = !on ? "★ Saved" : "☆ Save";
      try { localStorage.setItem("pulse_fav", String(!on)); } catch { }
    });
    // restore
    try {
      const saved = localStorage.getItem("pulse_fav") === "true";
      favBtn.setAttribute("aria-pressed", String(saved));
      favBtn.textContent = saved ? "★ Saved" : "☆ Save";
    } catch { }

    // ----------------------------
    // Ambient layer
    // ----------------------------
    document.querySelectorAll("[data-amb]").forEach(btn => {
      btn.addEventListener("click", async () => {
        const key = btn.getAttribute("data-amb");
        const src = AMBIENTS[key];
        if (!src) return;

        ambient.src = src;
        ambient.volume = Number(ambVol.value);

        try {
          await ambient.play();
          moodTag.textContent = key; // reuse as quick feedback
        } catch (e) {
          console.warn("Ambient play failed:", e);
          alert("Couldn’t start ambient audio (autoplay policy). Click play on main stream first.");
        }
      });
    });
    ambVol.addEventListener("input", () => { ambient.volume = Number(ambVol.value); });

    // ----------------------------
    // Focus Mode
    // ----------------------------
    function toggleFocusMode(force) {
      const on = typeof force === "boolean" ? force : !document.body.classList.contains("focus-mode");
      document.body.classList.toggle("focus-mode", on);
      focusToggle.setAttribute("aria-pressed", String(on));
    }
    focusToggle.addEventListener("click", () => toggleFocusMode());

    // ----------------------------
    // Settings modal + theming
    // ----------------------------
    function openOverlay(el) { el.classList.add("open"); }
    function closeOverlay(el) { el.classList.remove("open"); }

    settingsBtn.addEventListener("click", () => openOverlay(settingsOverlay));
    closeSettings.addEventListener("click", () => closeOverlay(settingsOverlay));

    helpBtn.addEventListener("click", () => openOverlay(helpOverlay));
    closeHelp.addEventListener("click", () => closeOverlay(helpOverlay));

    // close overlay on backdrop click
    [settingsOverlay, helpOverlay].forEach(ov => {
      ov.addEventListener("click", (e) => { if (e.target === ov) closeOverlay(ov); });
    });

    // theme presets
    function applyTheme(name) {
      const root = document.documentElement.style;
      if (name === "midnight") {
        root.setProperty("--aurora-a", "170 255 220");
        root.setProperty("--aurora-b", "130 190 255");
        root.setProperty("--aurora-c", "210 140 255");
      } else if (name === "sunset") {
        root.setProperty("--aurora-a", "255 190 150");
        root.setProperty("--aurora-b", "255 140 210");
        root.setProperty("--aurora-c", "150 210 255");
      } else if (name === "neon") {
        root.setProperty("--aurora-a", "180 255 140");
        root.setProperty("--aurora-b", "140 160 255");
        root.setProperty("--aurora-c", "255 120 240");
      }
      try { localStorage.setItem("pulse_theme", name); } catch { }
    }

    function applyMotion(level) {
      const aur = document.querySelector(".aurora");
      if (!aur) return;
      if (level === "low") {
        aur.style.filter = "blur(36px) saturate(110%)";
        aur.style.opacity = "0.10";
      } else if (level === "high") {
        aur.style.filter = "blur(26px) saturate(140%)";
        aur.style.opacity = "0.16";
      } else {
        aur.style.filter = "blur(32px) saturate(120%)";
        aur.style.opacity = "";
      }
      try { localStorage.setItem("pulse_motion", level); } catch { }
    }

    function applyFontSize(v) {
      if (v === "large") document.body.style.fontSize = "17px";
      else document.body.style.fontSize = "";
      try { localStorage.setItem("pulse_font", v); } catch { }
    }

    function applyReduceGlow(v) {
      document.documentElement.style.setProperty("--shadow", v === "on" ? "0 12px 40px rgba(0,0,0,.40)" : "");
      try { localStorage.setItem("pulse_reduce_glow", v); } catch { }
    }

    themeSelect.addEventListener("change", () => applyTheme(themeSelect.value));
    motionSelect.addEventListener("change", () => applyMotion(motionSelect.value));
    fontSize.addEventListener("change", () => applyFontSize(fontSize.value));
    reduceGlow.addEventListener("change", () => applyReduceGlow(reduceGlow.value));

    // restore
    try {
      const t = localStorage.getItem("pulse_theme") || "midnight";
      themeSelect.value = t; applyTheme(t);

      const m = localStorage.getItem("pulse_motion") || "med";
      motionSelect.value = m; applyMotion(m);

      const f = localStorage.getItem("pulse_font") || "normal";
      fontSize.value = f; applyFontSize(f);

      const rg = localStorage.getItem("pulse_reduce_glow") || "off";
      reduceGlow.value = rg; applyReduceGlow(rg);
    } catch { }

    // ----------------------------
    // Timer (Pomodoro + custom)
    // ----------------------------
    let timerMode = "focus"; // focus | break
    let focusMin = 25, breakMin = 5;
    let remaining = focusMin * 60;
    let timerRunning = false;
    let timerTick = null;

    // session stats (local only)
    function loadStats() {
      try {
        const todayKey = new Date().toISOString().slice(0, 10);
        const stats = JSON.parse(localStorage.getItem("pulse_stats") || "{}");
        return { todayKey, stats };
      } catch { return { todayKey: "", stats: {} }; }
    }
    function saveStats(stats) {
      try { localStorage.setItem("pulse_stats", JSON.stringify(stats)); } catch { }
    }
    function bumpToday(seconds) {
      const { todayKey, stats } = loadStats();
      stats[todayKey] = (stats[todayKey] || 0) + seconds;
      saveStats(stats);
      renderStats();
    }
    function computeStreak() {
      const { stats } = loadStats();
      const keys = Object.keys(stats).sort(); // YYYY-MM-DD
      if (!keys.length) return 0;

      // count back from today while >= 10 min/day
      const today = new Date();
      let streak = 0;
      for (let i = 0; i < 3650; i++) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const k = d.toISOString().slice(0, 10);
        const sec = stats[k] || 0;
        if (sec >= 10 * 60) streak++;
        else break;
      }
      return streak;
    }
    function renderStats() {
      const { todayKey, stats } = loadStats();
      const todaySec = stats[todayKey] || 0;
      todayMinEl.textContent = String(Math.floor(todaySec / 60));
      streakEl.textContent = String(computeStreak());
    }
    renderStats();

    function setTimer(minutes, mode) {
      timerMode = mode;
      remaining = minutes * 60;
      timerLabel.textContent = mode === "focus" ? "Focus" : "Break";
      renderTimer();
    }

    function renderTimer() {
      const mm = Math.floor(remaining / 60);
      const ss = remaining % 60;
      timerText.textContent = `${String(mm).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;

      const total = (timerMode === "focus" ? focusMin : breakMin) * 60;
      const p = total ? (1 - remaining / total) * 100 : 0;
      ring.style.setProperty("--p", Math.max(0, Math.min(100, p)).toFixed(1));
    }

    function stopTimer() {
      timerRunning = false;
      clearInterval(timerTick);
      timerTick = null;
      timerStartBtn.textContent = "Start";
    }

    function startTimer() {
      if (timerRunning) return;
      timerRunning = true;
      timerStartBtn.textContent = "Stop";

      let last = Date.now();
      timerTick = setInterval(() => {
        const now = Date.now();
        const delta = Math.max(0, Math.round((now - last) / 1000));
        last = now;

        remaining -= delta;
        if (timerMode === "focus") bumpToday(delta);

        if (remaining <= 0) {
          remaining = 0;
          renderTimer();
          stopTimer();

          // switch mode
          if (timerMode === "focus") {
            setTimer(breakMin, "break");
          } else {
            setTimer(focusMin, "focus");
          }

          // subtle notification
          try {
            const a = new AudioContext();
            const o = a.createOscillator();
            const g = a.createGain();
            o.type = "sine"; o.frequency.value = 660;
            g.gain.value = 0.0001;
            o.connect(g); g.connect(a.destination);
            o.start();
            g.gain.exponentialRampToValueAtTime(0.06, a.currentTime + 0.01);
            g.gain.exponentialRampToValueAtTime(0.0001, a.currentTime + 0.25);
            o.stop(a.currentTime + 0.27);
          } catch { }

        } else {
          renderTimer();
        }
      }, 1000);
    }

    pomodoroBtn.addEventListener("click", () => {
      focusMin = 25; breakMin = 5;
      setTimer(focusMin, "focus");
      stopTimer();
    });

    customBtn.addEventListener("click", () => {
      focusMin = clamp(Number(customFocus.value || 50), 5, 180);
      breakMin = clamp(Number(customBreak.value || 10), 1, 60);
      setTimer(focusMin, "focus");
      stopTimer();
    });

    timerStartBtn.addEventListener("click", () => {
      if (timerRunning) stopTimer();
      else startTimer();
    });
    timerResetBtn.addEventListener("click", () => {
      stopTimer();
      setTimer(timerMode === "focus" ? focusMin : breakMin, timerMode);
    });

    setTimer(focusMin, "focus");

    function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

    // ----------------------------
    // Keyboard shortcuts
    // ----------------------------
    window.addEventListener("keydown", (e) => {
      // don't hijack typing in inputs
      const t = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      if (t === "input" || t === "select" || t === "textarea") return;

      if (e.key === " ") {
        e.preventDefault();
        togglePlay();
      }
      if (e.key === "ArrowUp") {
        e.preventDefault();
        vol.value = String(Math.min(1, Number(vol.value) + 0.03));
        audio.volume = Number(vol.value);
      }
      if (e.key === "ArrowDown") {
        e.preventDefault();
        vol.value = String(Math.max(0, Number(vol.value) - 0.03));
        audio.volume = Number(vol.value);
      }
      if (e.key.toLowerCase() === "f") {
        toggleFocusMode();
      }
      if (e.key.toLowerCase() === "t") {
        if (timerRunning) stopTimer(); else startTimer();
      }
      if (e.key === "?") {
        openOverlay(helpOverlay);
      }
      if (e.key === "Escape") {
        closeOverlay(settingsOverlay);
        closeOverlay(helpOverlay);
      }
    });

    // ----------------------------
    // Optional: load time param
    // ----------------------------
    (function () {
      const url = new URL(window.location.href);
      const t = url.searchParams.get("t");
      if (t && !Number.isNaN(Number(t))) {
        audio.currentTime = Number(t);
      }
    })();

    // Make it obvious that the stream URL needs configuring
    if (STREAM_URL.includes("example.com")) {
      statusText.textContent = "Set stream URL";
      livePill.title = "Replace STREAM_URL in the script.";
    }
  </script>
</body>

</html>